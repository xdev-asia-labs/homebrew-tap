name: Update Formula

on:
    repository_dispatch:
        types: [update-formula]

jobs:
    update:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Update formula
              run: |
                  VERSION="${{ github.event.client_payload.version }}"
                  SHA256="${{ github.event.client_payload.sha256 }}"
                  TAG="${{ github.event.client_payload.tag }}"

                  sed -i "s|archive/refs/tags/v[0-9.]*\.tar\.gz|archive/refs/tags/${TAG}.tar.gz|g" Formula/xexplain.rb
                  sed -i "s|sha256 \"[a-f0-9]*\"|sha256 \"${SHA256}\"|g" Formula/xexplain.rb

            - name: Commit and push
              run: |
                  git config user.name "GitHub Action"
                  git config user.email "action@github.com"
                  git add Formula/xexplain.rb
                  git commit -m "Update xexplain to ${{ github.event.client_payload.tag }}"
                  git push
